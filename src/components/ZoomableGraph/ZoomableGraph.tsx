import React, { useEffect, useState } from 'react';
import styled from 'styled-components';

export interface OrbProps {
  id?: string;
  cx: number;
  cy: number;
  size?: number;
  fill?: string;
  visited?: boolean;
  onMouseEnter?: (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => void;
  onMouseLeave?: (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => void;
  onClick?: (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => void;
}

export const Orb = ({ 
  id,
  cx, 
  cy, 
  size=10, 
  fill="blue",
  onMouseEnter = () => {},
  onMouseLeave = () => {},
  onClick = () => {},
}: OrbProps) => (
  <circle id={id} cx={cx} cy={cy} r={size} fill={fill} onMouseEnter={(event) => onMouseEnter(event, cx, cy)} onMouseLeave={(event) => onMouseLeave(event, cx, cy)} onClick={(event) => onClick(event, cx, cy)} />
);

export const GraphSvg = styled.svg`
  width: 100%;
  height: 100%;
`;

export const GraphContainer = styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
`;

export interface ZoomableGraphProps {
  orbPropsList?: {[key: string]: OrbProps};
};

const ZoomableGraph = ({
  orbPropsList={},
}: ZoomableGraphProps) => {

  const [zoom, setZoom] = useState({ scale: 1, cx: 0, cy: 0 });
  const [zoomed, setZoomed] = useState(false);
  const [visited, setVisited] = useState<{ [key: string]: boolean }>(Object.keys(orbPropsList).reduce((acc, key) => ({ ...acc, [key]: false }), {}));

  const handleOrbClick = (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => {
    console.log(`Clicked orb at x: ${cx}, y: ${cy}`);
    if (zoomed) return;

    event.stopPropagation();

    setZoom({ scale: 2, cx, cy });
    setZoomed(true);

    const orb = (event.target as SVGCircleElement);
    setVisited((prevVisited) => ({ ...prevVisited, [orb.id]: true}));
  };

  const handleSvgClick = (event: React.MouseEvent<any, MouseEvent>) => {
    const point = event.currentTarget.createSVGPoint();
    point.x = event.clientX;
    point.y = event.clientY;
    const cursorPt = point.matrixTransform(event.currentTarget.getScreenCTM().inverse());
    console.log(`Clicked at x: (${cursorPt.x}, y: ${cursorPt.y})`);
    
    if (!zoomed) return;

    const newZoom = {
      scale: 1,
      cx: 0,
      cy: 0,
    };
    setZoom(newZoom);
    setZoomed(false);
  };

  const highLightOrb = (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => {
    const orb = event.target as SVGCircleElement;
    console.log(orb);
    console.log(`Hovered orb at x: ${cx}, y: ${cy}`, orb, visited[orb.id]);
    if (!visited[orb.id]) {
      orb.style.transition = "fill 0.3s ease";
      orb.setAttribute('data-original-fill', orb.getAttribute('fill') || '');
      orb.setAttribute('fill', 'blue');
    }
  };

  const unHighLightOrb = (event: React.MouseEvent<SVGCircleElement, MouseEvent>, cx: number, cy: number) => {
    const orb = event.target as SVGCircleElement;
    if (!visited[orb.id]) {
      orb.style.transition = "fill 0.3s ease";
      orb.setAttribute('fill', orb.getAttribute('data-original-fill') || '');
    }
  };


  const getOrbGrid = () => {
    return (
      <>
        {Object.keys(orbPropsList).map((orbName, index) => {
          const orbProps = orbPropsList[orbName];
          return (<Orb key={index} id={orbName} {...orbProps} onClick={handleOrbClick} onMouseEnter={highLightOrb} onMouseLeave={unHighLightOrb} />)
        })}
      </>
    );
  };

  return (
    <GraphContainer>
      <GraphSvg
        viewBox="0 0 305.89 272.83"
        onClick={handleSvgClick}
        style={{
          transformOrigin: `${(zoom.cx / 305.89) * 100}% ${(zoom.cy / 272.83) * 100}%`,
          transform: `scale(${zoom.scale})`,
          transition: 'transform 0.5s ease-in-out, transform-origin 0.5s ease-in-out',
        }}
      >
        <g transform="translate(-47.069 -63.563)">
          <path d="m143.71 63.851c-5.404 1.374-8.981 6.271-8.638 11.825l0.113 1.821-5.038 2.527c-2.772 1.389-6.258 3.159-7.747 3.932-1.49 0.773-6.458 3.306-11.042 5.627-13.194 6.684-22.324 11.317-27.5 13.955-2.635 1.344-7.524 3.831-10.864 5.528l-6.073 3.086-1.115-0.949c-4.585-3.902-11.005-3.811-15.226 0.215-5.784 5.517-4.176 15.143 3.074 18.403l1.558 0.7v40.224l-1.342 0.883c-11.506 7.565-1.14 25.539 11.211 19.439l1.223-0.604 8.256 5.952c4.541 3.273 13.46 9.698 19.819 14.278 13.122 9.449 11.868 8.376 11.872 10.152 0.021 8.992 11.436 13.832 18.558 7.868 1.17-0.98 0.799-0.996 5.299 0.227 3.359 0.913 16.072 4.36 36.136 9.797 3.833 1.039 7.027 1.959 7.097 2.045 0.07 0.085 0.297 0.717 0.505 1.403 2.425 8.014 13.256 11.386 19.312 6.012 0.356-0.316 0.378-0.306 17.347 7.574l3.522 1.635 0.037 2.391c0.098 6.309 4.304 10.756 10.606 11.214l1.853 0.135 0.685 1.771c0.377 0.974 2.554 6.552 4.837 12.396 2.282 5.843 5.623 14.398 7.424 19.011l3.274 8.387-0.927 1.092c-6.765 7.976 1.898 19.256 11.242 14.638 8.515-4.207 5.454-17.816-4.007-17.816-0.657 0-0.66-6e-3 -1.923-3.281-0.696-1.805-3.06-7.875-5.253-13.49-2.194-5.614-5.21-13.349-6.703-17.187-1.492-3.839-2.806-7.155-2.92-7.369-0.171-0.323-0.01-0.591 0.94-1.563 3.628-3.712 4.337-8.999 1.815-13.544l-0.622-1.122 1.085-1.378c0.596-0.758 3.435-4.378 6.307-8.045s6.384-8.145 7.804-9.952c1.419-1.808 2.651-3.214 2.737-3.125 0.215 0.22 11.019 24.423 11.019 24.684 0 0.115-0.473 0.728-1.053 1.361-4.888 5.35-3.301 13.886 3.241 17.423l1.248 0.675 0.784 10.509c0.431 5.779 1.095 14.633 1.477 19.675 0.722 9.541 0.722 9.548-0.236 9.788-7.204 1.805-9.494 12.877-3.814 18.441 8.493 8.321 22.533-0.604 18.487-11.751-1.156-3.185-5.164-6.999-7.355-6.999-0.359 0-0.346 0.147-1.843-20.104-1.605-21.709-1.522-19.193-0.638-19.359 4.551-0.853 8.244-5.77 8.244-10.973v-2.028l1.719-0.658c4.264-1.634 46.758-17.574 47.083-17.661 0.232-0.063 0.685 0.215 1.25 0.769 6.795 6.659 18.783 1.349 18.783-8.319 0-4.649-3.376-9.57-7.22-10.528-0.679-0.169-0.65 0.364-0.371-6.764 0.251-6.405 0.377-10.042 0.637-18.437 0.388-12.493 0.636-18.33 0.784-18.463 0.081-0.073 0.523-0.25 0.981-0.392 4.197-1.307 7.403-5.838 7.442-10.521 0.053-6.417-5.471-11.696-11.826-11.301l-1.675 0.104-6.413-12.681-6.413-12.682 1.041-1.199c8.765-10.093-4.472-24.687-15.064-16.608l-0.727 0.554-5.891-4.54c-3.24-2.497-6.453-4.974-7.141-5.504-0.687-0.529-7.156-5.511-14.375-11.069-24.844-19.128-22.714-17.431-22.66-18.056 0.498-5.786-0.14-8.146-2.965-10.979-5.868-5.883-16.173-3.607-18.637 4.118l-0.249 0.781h-41.442c-34.887 0-41.443-0.045-41.443-0.285 0-0.578-1.471-3.186-2.384-4.224-2.631-2.992-7.247-4.468-10.993-3.515m4.237 6.051c3.82 1.301 4.726 6.263 1.628 8.915-2.496 2.136-6.426 1.342-7.941-1.604-2.11-4.103 1.946-8.8 6.313-7.311m104.37-0.077c3.946 1.345 5 6.204 1.931 8.905-3.949 3.476-10.065-0.621-8.318-5.571 0.935-2.651 3.88-4.189 6.387-3.334m-12.1 8.835c0.135 0.409 0.212 0.769 0.172 0.8-0.667 0.525-39.105 31.757-58.103 47.211-10.461 8.509-9.228 7.648-10.01 6.99-1.625-1.367-4.974-2.535-7.92-2.763-0.926-0.071-1.713-0.232-1.752-0.357-0.038-0.126-0.776-3.228-1.64-6.895-0.863-3.667-3.26-13.78-5.327-22.474-4.275-17.982-3.994-16.375-2.977-17.055 1.521-1.014 2.766-2.502 3.662-4.371l0.87-1.816 82.78-0.013 0.245 0.743m-99.067 6.191c1.315 0.656 3.103 1.191 3.982 1.191 0.465 0 0.711 0.114 0.785 0.364 0.095 0.322 1.033 4.266 3.555 14.948 0.405 1.719 1.441 6.078 2.301 9.688 0.86 3.609 2.316 9.75 3.235 13.646 0.92 3.895 1.719 7.233 1.776 7.416 0.072 0.233-0.293 0.589-1.223 1.19-1.678 1.085-3.865 3.394-4.761 5.025-0.849 1.545 0.651 1.72-11.442-1.34-5.66-1.432-17.37-4.394-26.021-6.582-13.919-3.52-32.197-8.146-40.757-10.315l-2.945-0.747-0.122-0.756c-0.068-0.416-0.054-0.826 0.03-0.91 0.165-0.164 64.414-32.84 67.747-34.455l0.933-0.452 0.942 0.785c0.519 0.431 1.412 1.018 1.985 1.304m131.88 9.975c35.12 27.041 35.418 27.275 35.367 27.743-0.257 2.356-0.35 2.877-0.529 2.988-0.115 0.07-4.93 1.414-10.702 2.987l-10.494 2.859-1.196-0.289c-0.703-0.171-2.054-0.271-3.278-0.244l-2.082 0.045-1.485-3.218c-0.816-1.77-3.849-8.327-6.739-14.572-11.236-24.278-13.55-29.309-13.55-29.457 0-0.084 0.961 0.587 2.136 1.492 1.174 0.905 6.823 5.255 12.552 9.666m-31.633-4.264c-1.212 3.071-3.198 8.115-4.415 11.209-1.216 3.094-3.326 8.437-4.688 11.875-1.361 3.437-4.393 11.108-6.736 17.046-2.343 5.939-4.292 10.828-4.332 10.866-0.039 0.038-8.227 0.219-18.196 0.401s-19.638 0.366-21.487 0.409l-3.362 0.077-0.55-1.587c-0.302-0.873-0.571-1.695-0.596-1.827-0.026-0.132 4.781-4.166 10.682-8.965 25.991-21.135 43.453-35.332 46.25-37.602 1.662-1.348 4.466-3.627 6.232-5.063s3.253-2.569 3.305-2.517c0.053 0.052-0.896 2.608-2.107 5.678m14.672 2.771c1.828 3.953 3.521 7.61 3.762 8.125 0.473 1.01 6.108 13.194 11.454 24.761 3.891 8.421 3.532 7.054 2.214 8.417-1.309 1.353-2.266 2.907-2.922 4.741l-0.484 1.352-2.073 0.044c-16.239 0.341-39.93 0.71-40.017 0.624-0.102-0.103 2.831-7.616 15.511-39.73 2.511-6.36 4.923-12.481 5.36-13.602l0.796-2.039 3.076 0.12 3.323 7.187m-196 21.371c2.025 0.69 3.366 2.634 3.366 4.879 0 4.78-5.879 7.017-9.025 3.434-3.535-4.025 0.566-10.048 5.659-8.313m261.47 6.224c4.756 2.293 3.511 9.374-1.732 9.85-3.474 0.315-6.289-2.787-5.573-6.141 0.709-3.325 4.31-5.153 7.305-3.709m-236.42 8.556c19.961 5.052 46.614 11.793 56.25 14.227l7.292 1.841 0.062 0.72c0.056 0.649-6e-3 0.744-0.625 0.962-5.43 1.913-41.04 14.224-41.142 14.224-0.077 0-0.85-0.679-1.718-1.51-4.321-4.138-10.814-10.299-21.89-20.77-12.851-12.15-14.537-13.764-14.372-13.757 0.056 2e-3 7.32 1.831 16.143 4.063m-17.366 3.224c1.873 1.776 4.343 4.13 5.49 5.231 1.146 1.101 7.669 7.288 14.494 13.75s12.415 11.842 12.423 11.957c9e-3 0.114-0.701 0.458-1.575 0.764-0.875 0.305-6.091 2.118-11.591 4.027s-11.68 4.056-13.734 4.771l-3.734 1.299-1.37-1.382c-1.823-1.838-3.16-2.536-6.631-3.459-0.206-0.055-0.26-4.156-0.26-19.623v-19.553l1.302-0.534c1.716-0.704 1.322-0.913 5.186 2.752m242.32-0.646c1.615 2.734 5.615 4.809 9.287 4.817l1.801 5e-3 6.449 12.77 6.45 12.771-0.959 1.235c-1.7 2.19-2.396 3.994-2.633 6.818l-0.14 1.675-6.25 2.174c-3.438 1.195-12.413 4.32-19.946 6.944-15.855 5.523-13.917 5.037-14.741 3.699-1.371-2.229-4.067-4.525-6.575-5.6-0.562-0.241-1.049-0.466-1.083-0.499-0.056-0.056 0.321-3.511 1.943-17.829 0.292-2.578 0.596-4.743 0.675-4.811s0.684-0.239 1.344-0.38c7.969-1.705 12.243-11.931 7.869-18.826-0.472-0.744-0.561-1.024-0.353-1.104 0.443-0.17 16.051-4.432 16.29-4.448 0.119-8e-3 0.376 0.257 0.572 0.589m-143.29 5.456c5.924 2.216 7.514 9.881 2.991 14.416-5.021 5.036-13.548 2.255-14.791-4.824-1.147-6.536 5.508-11.946 11.8-9.592m118.69-0.055c6.387 3.132 4.244 12.625-2.853 12.638-7.416 0.014-9.215-10.274-2.258-12.914 1.229-0.466 3.891-0.322 5.111 0.276m-15.11 9.516c0.038 0.115-2.663 3.162-6.001 6.771-15.704 16.982-23.371 25.208-23.488 25.203-0.071-2e-3 -0.826-0.19-1.677-0.416-7.728-2.055-14.379 5.636-11.221 12.976l0.433 1.006-0.517 0.564c-1.86 2.026-19.745 21.372-24.115 26.084-2.923 3.151-6.295 6.787-7.493 8.08-2.118 2.287-2.189 2.341-2.563 1.967s-0.355-0.459 0.684-3.081c0.588-1.482 5.286-13.383 10.44-26.445 5.154-13.063 10.298-26.094 11.43-28.959 1.133-2.864 3.648-9.239 5.59-14.166l3.531-8.959 18.612-0.355c10.237-0.195 20.159-0.386 22.05-0.425 4.333-0.089 4.225-0.093 4.305 0.155m-51.597 0.816c0 0.136-1.191 3.198-4.259 10.955-1.564 3.953-3.582 9.063-4.485 11.354-0.903 2.292-4.048 10.261-6.989 17.709-2.941 7.447-6.233 15.791-7.317 18.541s-3.295 8.356-4.915 12.457l-2.946 7.457-2.525-0.122-2.55-10.729c-1.402-5.901-3.392-14.292-4.422-18.646s-3.422-14.431-5.316-22.393c-1.893-7.962-3.443-14.582-3.443-14.712s0.623-0.6 1.385-1.045c3.454-2.018 6.426-5.933 7.057-9.299 0.081-0.429 0.159-0.79 0.175-0.801 0.167-0.121 40.55-0.844 40.55-0.726m55.88 5.634c0.463 0.397 1.448 1.029 2.189 1.406l1.346 0.686-0.115 1.25c-0.83 8.981-2.387 21.359-2.697 21.443-0.137 0.037-0.858 0.18-1.603 0.318-10.32 1.917-15.135 14.932-8.661 23.413 0.409 0.537 0.744 1.029 0.744 1.094 0 0.151-11.823 15.238-12.052 15.379-0.153 0.095-10.656-23.091-10.656-23.526 0-0.103 0.319-0.519 0.708-0.925 2.195-2.287 2.936-6.133 1.823-9.463l-0.409-1.224 10.241-11.061c17.065-18.431 18.071-19.511 18.188-19.511 0.061 0 0.491 0.325 0.954 0.721m-123.28 0.617c2.24 3.374 6.202 5.797 10.445 6.388 1.848 0.256 1.801 0.217 2.154 1.822 0.143 0.65 0.994 4.275 1.891 8.057 2.368 9.977 8.382 35.282 11.147 46.898 2.741 11.516 2.596 10.542 1.657 11.123l-0.73 0.45-1.216-1.111c-1.146-1.046-34.646-32.77-38.679-36.627-1.031-0.987-2.953-2.824-4.271-4.084-1.318-1.259-6.732-6.395-12.031-11.413-5.3-5.018-9.636-9.196-9.636-9.284s3.164-1.254 7.032-2.591c3.867-1.338 12.375-4.297 18.906-6.577 13.747-4.799 12.379-4.486 13.331-3.051m192.24 11.995c1.971 0.738 3.342 2.754 3.323 4.888-0.044 4.876-6.463 6.979-9.324 3.054-3.109-4.267 1.063-9.789 6.001-7.942m-236.83 3.682c0.687 0.645 2.14 2.025 3.229 3.068 2.209 2.116 4.913 4.68 19.688 18.668 10.471 9.913 12.292 11.64 15.724 14.91 1.091 1.039 2.328 2.211 2.75 2.604 7.354 6.865 26.005 24.71 26.005 24.88 0 0.718-0.647 0.596-9.432-1.783-4.953-1.342-14.959-4.049-22.235-6.016s-13.391-3.624-13.589-3.682c-0.307-0.09-0.342-0.282-0.235-1.303 1.065-10.187-12.02-16.153-19.245-8.774l-1.027 1.049-13.213-9.521c-20.25-14.593-23.611-17.017-24.245-17.487l-0.586-0.435 0.442-1.336c0.242-0.735 0.503-2.011 0.578-2.836 0.131-1.443 0.161-1.509 0.784-1.732 0.357-0.128 6.18-2.154 12.94-4.504 6.761-2.349 13.979-4.867 16.042-5.595 4.553-1.609 4.11-1.596 5.625-0.175m-44.24 6.649c3.211 1.62 3.789 5.933 1.123 8.39-2.309 2.128-6.057 1.745-7.769-0.795-3.059-4.539 1.768-10.055 6.646-7.595m269.72 1.922c-0.149 0.207-5.789 7.612-12.532 16.456l-12.259 16.079-8.261-5.537c-9.983-6.691-8.894-5.687-8.23-7.587 0.376-1.078 0.584-2.203 0.673-3.642l0.129-2.083 2.187-0.766c1.203-0.422 4.203-1.468 6.667-2.324 12.765-4.439 28.217-9.828 29.688-10.354 2.042-0.73 2.315-0.764 1.938-0.242m5.99 3.434c0.159 0.413-1.342 43.125-1.521 43.288-0.087 0.078-0.528 0.26-0.98 0.405-0.84 0.269-2.677 1.274-3.24 1.773-0.268 0.237-1.696-0.655-9.896-6.176-5.271-3.55-9.708-6.528-9.861-6.619-0.204-0.12 2.371-3.64 9.556-13.063 5.409-7.094 11.018-14.464 12.466-16.377 2.503-3.31 3.198-3.956 3.476-3.231m-99.2 2.239c3.549 2.402 1.963 8.116-2.253 8.116-4.766 0-6.194-6.316-1.892-8.366 1.18-0.563 3.117-0.446 4.145 0.25m40.03 0.521c6.538 1.692 8.792 9.961 4.017 14.736-6.251 6.25-16.881 0.104-14.648-8.47 1.207-4.633 6.007-7.463 10.631-6.266m-44.988 12.386c0.333 0.113 1.245 0.277 2.028 0.364l1.423 0.158 2.143 4.792c1.179 2.635 3.806 8.494 5.839 13.02 2.032 4.526 3.74 8.383 3.795 8.571 0.085 0.29-17.748 23.39-19.402 25.133-0.443 0.467-0.465 0.469-1.378 0.123-3.118-1.179-7.619-0.2-10.749 2.34l-0.863 0.7-6.324-2.933c-3.478-1.614-7.355-3.404-8.616-3.978-2.036-0.928-4.698-2.215-4.846-2.344-0.03-0.026 0.103-0.46 0.296-0.965 0.414-1.089 0.496-5.374 0.119-6.269-0.238-0.565 2.021-3.15 12.533-14.336 0.7-0.745 2.308-2.48 3.573-3.855 3.052-3.317 2.561-2.786 11.402-12.336 4.266-4.609 7.907-8.382 8.09-8.386 0.183-3e-3 0.605 0.087 0.937 0.201m69.401 18.623c0.198 0.183 0.054 0.493-0.64 1.38-0.492 0.629-6.924 9.066-14.294 18.748s-13.462 17.675-13.538 17.761c-0.076 0.087-0.649 2e-3 -1.273-0.188-0.65-0.198-1.912-0.354-2.952-0.366l-1.817-0.019-5.973-13.334c-3.285-7.333-6.094-13.62-6.242-13.971-0.269-0.637-0.262-0.649 3.484-5.417 2.064-2.628 5.269-6.724 7.122-9.101 2.727-3.5 3.448-4.305 3.785-4.227 0.229 0.053 1.12 0.297 1.979 0.542 4.102 1.17 9.253 0.182 12.677-2.432l0.913-0.697 8.257 5.542c4.541 3.049 8.372 5.649 8.512 5.779m-183.98-0.1c3.399 1.544 4.184 5.914 1.529 8.511-3.29 3.216-8.838 0.794-8.808-3.845 0.023-3.54 4.06-6.128 7.279-4.666m199.45 10.436c9.229 6.179 9.795 6.593 9.675 7.084-0.07 0.286-0.188 1.552-0.263 2.812l-0.136 2.292-23.503 8.823c-12.927 4.852-23.548 8.778-23.602 8.724-0.055-0.054 1.194-1.792 2.774-3.861s7.795-10.233 13.81-18.143c6.016-7.91 11.052-14.362 11.191-14.337 0.139 0.024 4.663 2.997 10.054 6.606m22.346 5.326c3.531 1.204 4.529 5.926 1.813 8.582-3.26 3.187-8.797 0.859-8.797-3.699 0-3.593 3.529-6.06 6.984-4.883m-153.14 1.747c4.061 2.089 4.821 7.298 1.492 10.22-4.814 4.227-12.079-0.8-9.832-6.804 1.235-3.303 5.314-4.974 8.34-3.416m39.59 22.362c3.738 2.198 3.537 7.395-0.356 9.235-4.331 2.048-8.924-2.561-6.866-6.89 1.281-2.695 4.725-3.813 7.222-2.345m44.061 3.699c3.091 0.672 4.931 4.226 3.667 7.084-1.57 3.549-6.234 4.284-8.725 1.374-3.247-3.793 0.176-9.518 5.058-8.458m-20.885 57.356c2.614 1.42 2.946 5.366 0.602 7.154-4.275 3.26-9.499-2.367-5.861-6.313 1.42-1.541 3.391-1.856 5.259-0.841m24.462 4.288c2.294 1.171 3.357 4.352 2.24 6.703-1.921 4.041-7.749 4.014-9.495-0.045-1.976-4.592 2.769-8.946 7.255-6.658" fillRule="evenodd"/>
        </g>
        {getOrbGrid()}
      </GraphSvg>
    </GraphContainer>
  );
};

export default ZoomableGraph;

